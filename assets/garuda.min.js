(function(b,a){a.Garuda={configInit:function(){if(b("#institute").val()!=""){this.getConfig()}},configOpenSelected:function(){b('input[type="checkbox"].selector:checked').parents("li").children('input[type="checkbox"].tree').attr("checked",true);b("span.actions a.all").each(function(){b(this).on("click",function(){b(this).parent().siblings("ul").children("li").children('input[type="checkbox"].selector').attr("checked",true)})});b("span.actions a.none").each(function(){b(this).on("click",function(){b(this).parent().siblings("ul").children("li").children('input[type="checkbox"].selector').attr("checked",false)})})},getConfig:function(){var c=b("#institute").data("update-url").split("?");var d=c[0]+"/"+encodeURIComponent(b("#institute").val());if(c[1]!=""){d+="?"+c[1]}b("#config").html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));b("#config").load(d)},init:function(){if(b('input[name="sendto"]:checked').val()=="all"||b('input[name="sendto"]:checked').val()=="list"){b('button[name="add_filter"]').addClass("hidden-js")}b('input[name="sendto"]').on("click",function(){var e=b(".filtertext").data("text-src").split("?");var f=e[0]+"/sendto_all";if(e[1]!=""){f+="?"+e[1]}b(".filtertext").load(f);b(".userfilter").remove();if(b('input[name="sendto"]:checked').val()!="all"&&b('input[name="sendto"]:checked').val()!="list"){b('button[name="add_filter"]').removeClass("hidden-js")}else{b('button[name="add_filter"]').addClass("hidden-js")}if(b('input[name="sendto"]:checked').val()=="list"){b("#reclist").css("display","");b("#reclist textarea").attr("disabled",false);b("span.filtertext").addClass("hidden-js")}else{b("#reclist").css("display","none");b("#reclist textarea").attr("disabled",true);b("span.filtertext").removeClass("hidden-js")}});b('input[name="use_tokens"]').on("click",function(e){b("section.use_tokens").toggleClass("hidden-js")});b('input[name="send_at_date"]').on("click",function(e){b("section.send_date").toggleClass("hidden-js")});b('input[name="send_date"]').datetimepicker();b(".userfilter_actions a.delete").on("click",function(j){j.preventDefault();var h=b(this).parents(".userfilter");var f=h.parent();h.remove();if(f.children(".userfilter").length==0){var i=f.children(".filtertext");var e=i.data("text-src").split("?");var g=e[0]+"/sendto_all";if(e[1]!=""){g+="?"+e[1]}i.html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));i.load(g)}});b("#reclist").css("display","none");b("#reclist textarea").attr("disabled",true);b('textarea[name="message"]').typing({stop:function(){var e=b('textarea[name="message"]').data("preview-url").split("?");e=e[0];b("#message_preview_text").load(e,{text:encodeURIComponent(b('textarea[name="message"]').val())})},delay:500});var d=b('textarea[name="message"]').width();b("#message_preview_text").width(d);b("#message_preview_text").css("max-width",d);var c=b('textarea[name="message"]').height();b("#message_preview").css("left",d+30)},initFilter:function(){b("#add_field").on("click",function(c){c.preventDefault();var d=b(".filterfield").first().clone();d.children(".fieldconfig").empty();d.children("select").val("");b("#filterfields").append(d)})},initField:function(){b('select[name="value[]"] option').each(function(){var c=b(this).prev();if(b(this).attr("value").indexOf("_children")!=-1){c.attr("class","fac");b(this).attr("class","fac_all")}if(c.attr("class")=="fac_all"||c.attr("class")=="inst"){b(this).attr("class","inst")}})},initRecipientView:function(){b("li.degree label").on("click",function(e){var c=b(this).children("img").first();var d=c.data("toggle-icon");c.data("toggle-icon",c.attr("src"));c.attr("src",d)});b("li.faculty label").on("click",function(e){var c=b(this).children("img").first();var d=c.data("toggle-icon");c.data("toggle-icon",c.attr("src"));c.attr("src",d)})},getFieldConfig:function(g){var h=b(g).parents(".filterfield");var d=h.data("relation");if(d!=""){var c=encodeURIComponent(b(g).siblings('select[name="compare_operator[]"]').val());var k=encodeURIComponent(b(g).val());var j=b("#"+d);var e=b(g).parent().data("update-url").split("?");url=e[0]+"/"+d;var i=j.find('select[name="compare_operator[]"]').val();var f=j.find('select[name="value[]"]').val();url+="/"+c+"/"+k;if(e[1]!=""){url+="?"+e[1]}j.children(".fieldconfig").html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));j.children(".fieldconfig").load(url,function(){j.children(".fieldconfig").find('option[value="'+i+'"]').attr("selected",true);j.children(".fieldconfig").find('option[value="'+f+'"]').attr("selected",true)})}},getFilterConfig:function(f){var g="";var e="";var c=b(f).data("config-url").split("?");var d=c[0]+"/"+encodeURIComponent(b(f).val());if(c[1]!=""){d+="?"+c[1]}b(f).siblings(".fieldconfig").html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));b(f).siblings(".fieldconfig").load(d)},removeFilter:function(e){b(e).parents(".userfilter").remove();var g=b(".filtertext");var f=b(".userfilter").length;var c=g.data("text-src").split("?");if(f==0){var d=c[0]+"/sendto_all";if(c[1]!=""){d+="?"+c[1]}}else{if(f==1){var d=c[0]+"/sendto_filtered/true";if(c[1]!=""){d+="?"+c[1]}}else{var d=c[0]+"/sendto_filtered"+c[1];if(c[1]!=""){d+="?"+c[1]}}}g.html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));g.load(d);return false},replaceSender:function(e,c){var d=b("<div>").html(c).text();b("input#garuda-senderid").attr("value",e);b("span#garuda-sendername").html("("+d+")").removeClass("hidden-js");return false}};b(document).ready(function(){b("span.garuda-more a, span.garuda-messagetext a").on("click",function(c){b(c.target).closest("span").toggleClass("hidden-js");b(c.target).closest("span").siblings("span").toggleClass("hidden-js");return false});b('input[type="radio"].garuda-sender-config').on("click",function(c){if(b(this).attr("value")=="person"){b("#garuda-sender-choose-person").removeClass("hidden-js")}else{b("#garuda-sender-choose-person").addClass("hidden-js");b("span#garuda-sendername").addClass("hidden-js")}});if(b("form.garuda-js-init").length>0){a.Garuda.init()}});b(document).on("dialog-open",function(c){if(b("form.garuda-js-init").length>0){a.Garuda.init()}})}(jQuery,STUDIP));