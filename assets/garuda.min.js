(function(b,a){a.Garuda={configInit:function(){if(b("#institute").val()!=""){this.getConfig()}},configOpenSelected:function(){b('input[type="checkbox"].selector:checked').parents("li").children('input[type="checkbox"].tree').attr("checked",true);b("span.actions a.all").each(function(){b(this).on("click",function(){b(this).parent().siblings("ul").children("li").children('input[type="checkbox"].selector').attr("checked",true)})});b("span.actions a.none").each(function(){b(this).on("click",function(){b(this).parent().siblings("ul").children("li").children('input[type="checkbox"].selector').attr("checked",false)})})},getConfig:function(){var c=b("#institute").data("update-url").split("?");var d=c[0]+"/"+encodeURIComponent(b("#institute").val());if(c[1]!=""){d+="?"+c[1]}b("#config").html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));b("#config").load(d)},init:function(){if(b('input[name="sendto"]:checked').val()=="all"||b('input[name="sendto"]:checked').val()=="courses"||b('input[name="sendto"]:checked').val()=="list"){b('button[name="add_filter"]').addClass("hidden-js")}b('input[name="sendto"]').on("click",function(){var g=b(".filtertext").data("text-src").split("?");if(b('input[name="sendto"]:checked').val()=="courses"){var h=g[0]+"/sendto_courses"}else{var h=g[0]+"/sendto_all"}if(g[1]!=""){h+="?"+g[1]}b(".filtertext").load(h);b(".userfilter").remove();if(b('input[name="sendto"]:checked').val()!="all"&&b('input[name="sendto"]:checked').val()!="courses"&&b('input[name="sendto"]:checked').val()!="list"){b('button[name="add_filter"]').removeClass("hidden-js")}else{b('button[name="add_filter"]').addClass("hidden-js")}if(b('input[name="sendto"]:checked').val()=="list"){b("#reclist").css("display","block");b("#reclist textarea").attr("disabled",false);b("span.filtertext").addClass("hidden-js")}else{b("#reclist").css("display","none");b("#reclist textarea").attr("disabled",true);b("span.filtertext").removeClass("hidden-js")}if(b('input[name="sendto"]:checked').val()=="courses"){b("div#garuda-coursesearch").removeClass("hidden-js")}else{b("div#garuda-coursesearch").addClass("hidden-js")}});b('input[name="exclude"]').on("click",function(){if(b(this).prop("checked")){b("#excludelist").css("display","block");b('textarea[name="excludelist"]').attr("disabled",false)}else{b("#excludelist").css("display","none");b('textarea[name="excludelist"]').attr("disabled",true)}});b('input[name="use_tokens"]').on("click",function(g){b("section.use_tokens").toggleClass("hidden-js")});var f=b("label#garuda-markers");var d=b("#garuda-add-marker");f.children("select").on("change",function(){var g=b(this).children("option:selected");b("#garuda-marker-description").html(g.data("description"));if(g.attr("value")!=""){d.removeClass("hidden-js")}else{d.addClass("hidden-js")}});f.insertAfter("div.buttons");d.on("click",function(){f.parent().children("textarea").insertAtCaret(b("label#garuda-markers select option:selected").attr("value"));return false});b('input[name="send_at_date"]').on("click",function(g){b("section.send_date").toggleClass("hidden-js")});b('input[name="send_date"]').datetimepicker();b(".userfilter_actions a.delete").on("click",function(l){l.preventDefault();var j=b(this).parents(".userfilter");var h=j.parent();j.remove();if(h){if(h.children(".userfilter").length==0){var k=h.children(".filtertext");var g=k.data("text-src").split("?");var i=g[0]+"/sendto_all";if(g[1]!=""){i+="?"+g[1]}k.html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));k.load(i)}}});if(b('input[name="sendto"]:checked').val()!="list"){b("#reclist").css("display","none");b("#reclist textarea").attr("disabled",true)}if(!b('input[name="exclude"]').attr("checked")){b("#excludelist").css("display","none");b('textarea[name="excludelist]').attr("disabled",true)}b('textarea[name="message"]').typing({stop:function(){var g=b('textarea[name="message"]').data("preview-url").split("?");g=g[0];b("#message_preview_text").load(g,{text:encodeURIComponent(b('textarea[name="message"]').val())})},delay:500});var e=b('textarea[name="message"]').width();b("#message_preview_text").width(e);b("#message_preview_text").css("max-width",e);var c=b('textarea[name="message"]').height();b("#message_preview").css("left",e+30)},initFilter:function(){b("#add_field").on("click",function(c){c.preventDefault();var d=b(".filterfield").first().clone();d.children(".fieldconfig").empty();d.children("select").val("");b("#filterfields").append(d)})},initField:function(){b('select[name="value[]"] option').each(function(){var c=b(this).prev();if(b(this).attr("value").indexOf("_children")!=-1){c.attr("class","fac");b(this).attr("class","fac_all")}if(c.attr("class")=="fac_all"||c.attr("class")=="inst"){b(this).attr("class","inst")}})},initRecipientView:function(){b("li.degree label").on("click",function(e){var c=b(this).children("img").first();var d=c.data("toggle-icon");c.data("toggle-icon",c.attr("src"));c.attr("src",d)});b("li.faculty label").on("click",function(e){var c=b(this).children("img").first();var d=c.data("toggle-icon");c.data("toggle-icon",c.attr("src"));c.attr("src",d)})},getFieldConfig:function(h){var i=b(h).parents(".filterfield");var e=i.data("relation");if(e!=""){var d=encodeURIComponent(b(h).siblings('select[name="compare_operator[]"]').val());var l=encodeURIComponent(b(h).val());var k=b("#"+e);var f=b(h).parent().data("update-url").split("?");var c=f[0]+"/"+e;var j=k.find('select[name="compare_operator[]"]').val();var g=k.find('select[name="value[]"]').val();c+="/"+d+"/"+l;if(f[1]!=""){c+="?"+f[1]}k.children(".fieldconfig").html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));k.children(".fieldconfig").load(c,function(){k.children(".fieldconfig").find('option[value="'+j+'"]').attr("selected",true);k.children(".fieldconfig").find('option[value="'+g+'"]').attr("selected",true)})}},getFilterConfig:function(f){var g="";var e="";var c=b(f).data("config-url").split("?");var d=c[0]+"/"+encodeURIComponent(b(f).val());if(c[1]!=""){d+="?"+c[1]}b(f).siblings(".fieldconfig").html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));b(f).siblings(".fieldconfig").load(d)},removeFilter:function(e){b(e).parents(".userfilter").remove();var g=b(".filtertext");var f=b(".userfilter").length;var c=g.data("text-src").split("?");if(f==0){var d=c[0]+"/sendto_all";if(c[1]!=""){d+="?"+c[1]}}else{if(f==1){var d=c[0]+"/sendto_filtered/true";if(c[1]!=""){d+="?"+c[1]}}else{var d=c[0]+"/sendto_filtered"+c[1];if(c[1]!=""){d+="?"+c[1]}}}g.html(b("<img>").attr("src",a.ASSETS_URL+"images/ajax_indicator_small.gif"));g.load(d);return false},replaceSender:function(e,c){var d=b("<div>").html(c).text();b("input#garuda-senderid").attr("value",e);b("span#garuda-sendername").html("("+d+")").removeClass("hidden-js");return false},addCourse:function(h,d){var f=b("<div>").html(d).text();var e=b("ul#garuda-courses");if(e.children("li."+h).length==0){var g=b("<li>").addClass(h).html(f);var c=b("<input>").attr("type","hidden").attr("name","courses[]").attr("value",h);g.append(c);e.append(g)}}};b(document).ready(function(){b("span.garuda-more a, span.garuda-messagetext a").on("click",function(c){b(c.target).closest("span").toggleClass("hidden-js");b(c.target).closest("span").siblings("span").toggleClass("hidden-js");return false});b('input[type="radio"].garuda-sender-config').on("click",function(c){if(b(this).attr("value")=="person"){b("#garuda-sender-choose-person").removeClass("hidden-js")}else{b("#garuda-sender-choose-person").addClass("hidden-js");b("span#garuda-sendername").addClass("hidden-js")}});if(b("form.garuda-js-init").length>0){a.Garuda.init()}});b(document).on("dialog-open",function(c){if(b("form.garuda-js-init").length>0){a.Garuda.init()}})}(jQuery,STUDIP));